<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LyxProbe v2.07 | Command Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #0a0a0a;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            line-height: 1.4;
            height: 100vh;
            overflow: hidden;
            cursor: default;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            padding: 10px;
        }

        .header {
            border-bottom: 2px solid #00ff00;
            padding: 10px 0;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            font-size: 1.2em;
            text-shadow: 0 0 5px #00ff00;
            letter-spacing: 2px;
        }

        .status-bar {
            display: flex;
            gap: 20px;
            font-size: 0.9em;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #00ff00;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .terminal {
            flex: 1;
            background: #000;
            border: 1px solid #00ff00;
            border-radius: 5px;
            padding: 15px;
            overflow-y: auto;
            font-size: 14px;
            display: flex;
            flex-direction: column;
        }

        .output {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 10px;
            padding-right: 5px;
        }

        /* Scrollbar styling */
        .output::-webkit-scrollbar {
            width: 10px;
        }

        .output::-webkit-scrollbar-track {
            background: #111;
        }

        .output::-webkit-scrollbar-thumb {
            background: #00ff00;
            border-radius: 5px;
        }

        .output::-webkit-scrollbar-thumb:hover {
            background: #00cc00;
        }

        .entry {
            margin-bottom: 10px;
            padding: 5px 0;
            border-bottom: 1px solid #222;
        }

        .entry:last-child {
            border-bottom: none;
        }

        .timestamp {
            color: #888;
            font-size: 0.9em;
            margin-right: 10px;
        }

        .prompt {
            color: #00ff00;
            font-weight: bold;
            margin-right: 5px;
        }

        .command {
            color: #fff;
            font-weight: bold;
        }

        .output-title {
            color: #00ffff;
            font-weight: bold;
            margin: 5px 0;
        }

        .output-content {
            color: #ccc;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            margin-left: 20px;
            padding: 5px;
            background: #111;
            border-left: 3px solid #00ff00;
        }

        .output-content.info { border-left-color: #00ffff; }
        .output-content.success { border-left-color: #00ff00; }
        .output-content.warning { border-left-color: #ffff00; }
        .output-content.error { border-left-color: #ff0000; }

        .input-area {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-top: 1px solid #333;
        }

        .input-prompt {
            color: #00ff00;
            font-weight: bold;
            margin-right: 10px;
            white-space: nowrap;
        }

        #command-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #fff;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            padding: 5px;
            outline: none;
        }

        #command-input:focus {
            background: rgba(0, 255, 0, 0.1);
        }

        .shortcuts {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #333;
            font-size: 0.8em;
            color: #888;
        }

        .shortcut {
            cursor: pointer;
            padding: 2px 8px;
            border: 1px solid #333;
            border-radius: 3px;
            transition: all 0.2s;
        }

        .shortcut:hover {
            border-color: #00ff00;
            color: #00ff00;
        }

        .help-text {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
            font-style: italic;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .entry.new {
            animation: fadeIn 0.3s ease-out;
        }

        .cursor {
            display: inline-block;
            width: 8px;
            height: 16px;
            background: #00ff00;
            margin-left: 2px;
            animation: blink 1s infinite;
            vertical-align: middle;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>LYXPROBE v2.07 | COMMAND INTERFACE</h1>
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-dot"></div>
                    <span>ONLINE</span>
                </div>
                <div class="status-item">
                    <div class="status-dot" style="background: #00ffff;"></div>
                    <span>SECURE</span>
                </div>
                <div class="status-item">
                    <div class="status-dot" style="background: #ffff00;"></div>
                    <span>OPERATOR MODE</span>
                </div>
            </div>
        </div>

        <div class="terminal">
            <div class="output" id="output">
                <div class="entry new">
                    <span class="timestamp">[{{ now.strftime('%H:%M:%S') if now else '00:00:00' }}]</span>
                    <span class="prompt">LYXPROBE&gt;</span>
                    <span class="command">system boot</span>
                    <div class="output-title">SYSTEM INITIALIZED</div>
                    <div class="output-content info">
                        LyxProbe v2.07 Command Interface
                        Connected to Database: âœ“
                        Operator Authentication: âœ“
                        Security Protocols: ACTIVE
                        
                        Type 'help' for available commands
                    </div>
                </div>
            </div>

            <div class="input-area">
                <div class="input-prompt">LYXPROBE&gt;</div>
                <input type="text" id="command-input" autocomplete="off" autofocus 
                       placeholder="Type command and press Enter...">
                <div class="cursor"></div>
            </div>

            <div class="shortcuts">
                <div class="shortcut" onclick="executeCommand('help')">HELP</div>
                <div class="shortcut" onclick="executeCommand('clear')">CLEAR</div>
                <div class="shortcut" onclick="executeCommand('system-info')">SYSTEM</div>
                <div class="shortcut" onclick="executeCommand('list-admins')">ADMINS</div>
                <div class="shortcut" onclick="executeCommand('list-users')">USERS</div>
                <div class="shortcut" onclick="clearTerminal()">RESET</div>
            </div>

            <div class="help-text">
                Press â†‘/â†“ for command history â€¢ Tab for auto-complete â€¢ Ctrl+L to clear
            </div>
        </div>
    </div>

    <script>
        let commandHistory = [];
        let historyIndex = -1;
        const outputElement = document.getElementById('output');
        const inputElement = document.getElementById('command-input');

        // Focus input on page load
        inputElement.focus();

        // Handle Enter key
        inputElement.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                const command = inputElement.value.trim();
                if (command) {
                    executeCommand(command);
                    inputElement.value = '';
                    historyIndex = -1;
                }
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                navigateHistory(-1);
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                navigateHistory(1);
            } else if (e.key === 'Tab') {
                e.preventDefault();
                autoComplete();
            }
        });

        // Clear terminal on Ctrl+L
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'l') {
                e.preventDefault();
                clearTerminal();
            }
        });

        // Click anywhere to focus input
        document.addEventListener('click', function() {
            inputElement.focus();
        });

        function navigateHistory(direction) {
            if (commandHistory.length === 0) return;
            
            historyIndex += direction;
            
            if (historyIndex < 0) {
                historyIndex = -1;
                inputElement.value = '';
                return;
            }
            
            if (historyIndex >= commandHistory.length) {
                historyIndex = commandHistory.length - 1;
            }
            
            if (historyIndex >= 0) {
                inputElement.value = commandHistory[historyIndex];
                // Move cursor to end
                inputElement.setSelectionRange(inputElement.value.length, inputElement.value.length);
            }
        }

        function autoComplete() {
            const commands = ['help', 'clear', 'date', 'whoami', 'list-users', 
                             'list-admins', 'kill-rogue', 'ban', 'unban', 
                             'promote', 'demote', 'user-info', 'system-info',
                             'export', 'ping', 'echo'];
            
            const input = inputElement.value.toLowerCase();
            const matches = commands.filter(cmd => cmd.startsWith(input));
            
            if (matches.length === 1) {
                inputElement.value = matches[0];
            } else if (matches.length > 1) {
                // Show suggestions
                const suggestion = matches[0];
                for (let i = 0; i < suggestion.length; i++) {
                    if (i >= input.length) {
                        inputElement.value = suggestion;
                        break;
                    }
                }
            }
        }

        function clearTerminal() {
            outputElement.innerHTML = '';
            addOutputEntry('SYSTEM', 'Terminal cleared', 'info');
            inputElement.value = '';
            inputElement.focus();
        }

        function executeCommand(command) {
            // Add command to output
            const timestamp = new Date().toLocaleTimeString('en-US', { 
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            const commandEntry = document.createElement('div');
            commandEntry.className = 'entry new';
            commandEntry.innerHTML = `
                <span class="timestamp">[${timestamp}]</span>
                <span class="prompt">LYXPROBE&gt;</span>
                <span class="command">${command}</span>
            `;
            outputElement.appendChild(commandEntry);
            
            // Add to history
            if (command !== 'clear') {
                commandHistory.unshift(command);
                if (commandHistory.length > 50) commandHistory.pop();
            }
            
            // Scroll to bottom
            outputElement.scrollTop = outputElement.scrollHeight;
            
            // Send to server
            fetch('/probe/execute', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ command: command })
            })
            .then(response => response.json())
            .then(data => {
                addOutputEntry(data.title, data.content, data.type);
            })
            .catch(error => {
                addOutputEntry('ERROR', 'Connection failed: ' + error.message, 'error');
            });
            
            // Clear input
            inputElement.value = '';
            inputElement.focus();
        }

        function addOutputEntry(title, content, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('en-US', { 
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            const entry = document.createElement('div');
            entry.className = 'entry new';
            entry.innerHTML = `
                <div class="output-title">${title}</div>
                <div class="output-content ${type}">${content}</div>
            `;
            outputElement.appendChild(entry);
            
            // Scroll to bottom
            outputElement.scrollTop = outputElement.scrollHeight;
        }

        // Initialize with welcome message
        setTimeout(() => {
            addOutputEntry('WELCOME', 
                'LyxProbe Command Interface v2.0 initialized.\n' +
                'Security Level: MAXIMUM\n' +
                'Operator: Authenticated\n' +
                'Ready for commands...\n\n' +
                'Type "help" for command list.', 
                'info');
        }, 100);

        document.addEventListener('DOMContentLoaded', function() {
            // Create context menu element
            const contextMenu = document.createElement('div');
            contextMenu.id = 'lyxprobe-context-menu';
            contextMenu.style.cssText = `
                position: fixed;
                background: rgba(16, 23, 41, 0.95);
                backdrop-filter: blur(20px);
                -webkit-backdrop-filter: blur(20px);
                border: 1px solid rgba(74, 144, 226, 0.4);
                border-radius: 12px;
                box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
                padding: 8px 0;
                min-width: 220px;
                z-index: 10000;
                display: none;
                font-family: 'Segoe UI', 'Roboto', sans-serif;
                font-size: 14px;
                color: #ffffff;
                overflow: hidden;
                animation: contextMenuFadeIn 0.15s ease-out;
            `;

            // Add keyframes for animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes contextMenuFadeIn {
                    from { opacity: 0; transform: scale(0.95) translateY(-10px); }
                    to { opacity: 1; transform: scale(1) translateY(0); }
                }

                @keyframes contextMenuFadeOut {
                    from { opacity: 1; transform: scale(1) translateY(0); }
                    to { opacity: 0; transform: scale(0.95) translateY(-10px); }
                }

                .context-menu-item {
                    padding: 10px 20px;
                    cursor: pointer;
                    display: flex;
                    align-items: center;
                    gap: 12px;
                    transition: all 0.2s ease;
                    position: relative;
                    overflow: hidden;
                }

                .context-menu-item:hover {
                    background: rgba(74, 144, 226, 0.2);
                }

                .context-menu-item:hover::before {
                    content: '';
                    position: absolute;
                    left: 0;
                    top: 0;
                    height: 100%;
                    width: 3px;
                    background: linear-gradient(to bottom, var(--primary-color), var(--accent-color));
                }

                .context-menu-item.danger:hover {
                    background: rgba(239, 68, 68, 0.2);
                }

                .context-menu-item.danger:hover::before {
                    background: linear-gradient(to bottom, #ef4444, #f87171);
                }

                .context-menu-item.success:hover {
                    background: rgba(16, 185, 129, 0.2);
                }

                .context-menu-item.success:hover::before {
                    background: linear-gradient(to bottom, #10b981, #34d399);
                }

                .context-menu-item.warning:hover {
                    background: rgba(245, 158, 11, 0.2);
                }

                .context-menu-item.warning:hover::before {
                    background: linear-gradient(to bottom, #f59e0b, #fbbf24);
                }

                .context-menu-divider {
                    height: 1px;
                    background: rgba(255, 255, 255, 0.1);
                    margin: 4px 0;
                }

                .context-menu-item-icon {
                    width: 20px;
                    height: 20px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 14px;
                    color: var(--accent-color);
                }

                .context-menu-item.danger .context-menu-item-icon {
                    color: #ef4444;
                }

                .context-menu-item.success .context-menu-item-icon {
                    color: #10b981;
                }

                .context-menu-item.warning .context-menu-item-icon {
                    color: #f59e0b;
                }

                .context-menu-item-text {
                    flex: 1;
                    user-select: none;
                }

                .context-menu-item-shortcut {
                    color: rgba(255, 255, 255, 0.5);
                    font-size: 12px;
                    font-family: 'Monaco', 'Courier New', monospace;
                }

                .context-submenu {
                    position: absolute;
                    left: 100%;
                    top: 0;
                    display: none;
                    min-width: 200px;
                    background: rgba(16, 23, 41, 0.95);
                    backdrop-filter: blur(20px);
                    border: 1px solid rgba(74, 144, 226, 0.4);
                    border-radius: 8px;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
                    padding: 8px 0;
                    animation: contextMenuFadeIn 0.15s ease-out;
                }

                .context-menu-item:hover .context-submenu {
                    display: block;
                }
            `;

            document.head.appendChild(style);

            // Define context menu items
            const menuItems = [
                {
                    icon: 'ðŸ”',
                    text: 'Quick Commands',
                    shortcut: 'Ctrl+Q',
                    items: [
                        { icon: 'ðŸ“Š', text: 'System Info', command: 'system-info' },
                        { icon: 'ðŸ‘¥', text: 'List Users', command: 'list-users' },
                        { icon: 'ðŸ›¡ï¸', text: 'List Admins', command: 'list-admins' },
                        { icon: 'ðŸ“ˆ', text: 'View Stats', command: 'stats' }
                    ]
                },
                { type: 'divider' },
                {
                    icon: 'âš¡',
                    text: 'Quick Actions',
                    shortcut: 'Ctrl+A',
                    items: [
                        { icon: 'ðŸš«', text: 'Kill Rogue Admins', command: 'kill-rogue', class: 'danger' },
                        { icon: 'ðŸ”„', text: 'Refresh Data', command: 'refresh' },
                        { icon: 'ðŸ§¹', text: 'Clear Terminal', command: 'clear' }
                    ]
                },
                { type: 'divider' },
                {
                    icon: 'ðŸ‘¤',
                    text: 'User Management',
                    items: [
                        {
                            icon: 'ðŸ”¨',
                            text: 'Ban User',
                            action: 'prompt',
                            prompt: 'Enter User ID to ban:',
                            command: 'ban'
                        },
                        {
                            icon: 'âœ…',
                            text: 'Unban User',
                            action: 'prompt',
                            prompt: 'Enter User ID to unban:',
                            command: 'unban'
                        },
                        {
                            icon: 'â¬†ï¸',
                            text: 'Promote to Admin',
                            action: 'prompt',
                            prompt: 'Enter User ID to promote:',
                            command: 'promote'
                        },
                        {
                            icon: 'â¬‡ï¸',
                            text: 'Demote Admin',
                            action: 'prompt',
                            prompt: 'Enter User ID to demote:',
                            command: 'demote'
                        },
                        { type: 'divider' },
                        {
                            icon: 'ðŸ“‹',
                            text: 'User Info',
                            action: 'prompt',
                            prompt: 'Enter User ID or Username:',
                            command: 'user-info'
                        }
                    ]
                },
                { type: 'divider' },
                {
                    icon: 'ðŸ’¾',
                    text: 'Export Data',
                    items: [
                        { icon: 'ðŸ‘¥', text: 'Export Users', command: 'export users' },
                        { icon: 'ðŸ›¡ï¸', text: 'Export Admins', command: 'export admins' }
                    ]
                },
                { type: 'divider' },
                {
                    icon: 'ðŸ“‹',
                    text: 'Copy Selection',
                    action: 'copy',
                    shortcut: 'Ctrl+C'
                },
                {
                    icon: 'ðŸ“¤',
                    text: 'Paste Command',
                    action: 'paste',
                    shortcut: 'Ctrl+V'
                },
                { type: 'divider' },
                {
                    icon: 'ðŸŽ¨',
                    text: 'Theme',
                    items: [
                        { icon: 'ðŸŒ™', text: 'Dark Theme', action: 'setTheme', value: 'dark' },
                        { icon: 'â˜€ï¸', text: 'Light Theme', action: 'setTheme', value: 'light' },
                        { icon: 'ðŸŒˆ', text: 'Cyberpunk', action: 'setTheme', value: 'cyberpunk' }
                    ]
                },
                { type: 'divider' },
                {
                    icon: 'â“',
                    text: 'Help & Docs',
                    action: 'openHelp',
                    shortcut: 'F1'
                },
                {
                    icon: 'âš™ï¸',
                    text: 'Settings',
                    action: 'openSettings'
                }
            ];
            
            // Build the context menu
            function buildContextMenu() {
                contextMenu.innerHTML = '';

                menuItems.forEach(item => {
                    if (item.type === 'divider') {
                        const divider = document.createElement('div');
                        divider.className = 'context-menu-divider';
                        contextMenu.appendChild(divider);
                        return;
                    }

                    const menuItem = document.createElement('div');
                    menuItem.className = `context-menu-item ${item.class || ''}`;

                    // Create icon
                    const icon = document.createElement('div');
                    icon.className = 'context-menu-item-icon';
                    icon.textContent = item.icon;

                    // Create text
                    const text = document.createElement('div');
                    text.className = 'context-menu-item-text';
                    text.textContent = item.text;

                    // Create shortcut
                    const shortcut = document.createElement('div');
                    shortcut.className = 'context-menu-item-shortcut';
                    shortcut.textContent = item.shortcut || '';

                    menuItem.appendChild(icon);
                    menuItem.appendChild(text);
                    menuItem.appendChild(shortcut);

                    // Handle click
                    menuItem.addEventListener('click', function(e) {
                        e.stopPropagation();

                        if (item.action === 'prompt' && item.prompt) {
                            showCommandPrompt(item.prompt, item.command);
                        } else if (item.command) {
                            executeCommand(item.command);
                        } else if (item.action === 'copy') {
                            copySelection();
                        } else if (item.action === 'paste') {
                            pasteCommand();
                        } else if (item.action === 'setTheme') {
                            setTheme(item.value);
                        } else if (item.action === 'openHelp') {
                            window.open('/probe/docs', '_blank');
                        } else if (item.action === 'openSettings') {
                            showSettings();
                        }

                        hideContextMenu();
                    });

                    // Handle submenu
                    if (item.items && item.items.length > 0) {
                        menuItem.style.position = 'relative';

                        const submenu = document.createElement('div');
                        submenu.className = 'context-submenu';

                        item.items.forEach(subItem => {
                            if (subItem.type === 'divider') {
                                const divider = document.createElement('div');
                                divider.className = 'context-menu-divider';
                                submenu.appendChild(divider);
                                return;
                            }

                            const subMenuItem = document.createElement('div');
                            subMenuItem.className = `context-menu-item ${subItem.class || ''}`;

                            const subIcon = document.createElement('div');
                            subIcon.className = 'context-menu-item-icon';
                            subIcon.textContent = subItem.icon;

                            const subText = document.createElement('div');
                            subText.className = 'context-menu-item-text';
                            subText.textContent = subItem.text;

                            subMenuItem.appendChild(subIcon);
                            subMenuItem.appendChild(subText);

                            subMenuItem.addEventListener('click', function(e) {
                                e.stopPropagation();

                                if (subItem.action === 'prompt' && subItem.prompt) {
                                    showCommandPrompt(subItem.prompt, subItem.command);
                                } else if (subItem.command) {
                                    executeCommand(subItem.command);
                                } else if (subItem.action === 'setTheme') {
                                    setTheme(subItem.value);
                                }

                                hideContextMenu();
                            });

                            submenu.appendChild(subMenuItem);
                        });

                        menuItem.appendChild(submenu);

                        // Show submenu on hover
                        menuItem.addEventListener('mouseenter', function() {
                            const rect = menuItem.getBoundingClientRect();
                            submenu.style.top = '0';

                            // Check if submenu would go off screen
                            if (rect.right + submenu.offsetWidth > window.innerWidth) {
                                submenu.style.left = 'auto';
                                submenu.style.right = '100%';
                            } else {
                                submenu.style.left = '100%';
                                submenu.style.right = 'auto';
                            }
                        });
                    }

                    contextMenu.appendChild(menuItem);
                });
            }

            // Build initial menu
            buildContextMenu();
            document.body.appendChild(contextMenu);

            // Store right-click position
            let rightClickPosition = { x: 0, y: 0 };

            // Show context menu
            function showContextMenu(x, y) {
                // Ensure menu stays within viewport
                const menuWidth = contextMenu.offsetWidth;
                const menuHeight = contextMenu.offsetHeight;

                let finalX = x;
                let finalY = y;

                if (x + menuWidth > window.innerWidth) {
                    finalX = window.innerWidth - menuWidth - 10;
                }

                if (y + menuHeight > window.innerHeight) {
                    finalY = window.innerHeight - menuHeight - 10;
                }

                contextMenu.style.left = finalX + 'px';
                contextMenu.style.top = finalY + 'px';
                contextMenu.style.display = 'block';
                contextMenu.style.animation = 'contextMenuFadeIn 0.15s ease-out';

                // Add backdrop overlay
                if (!document.getElementById('context-menu-backdrop')) {
                    const backdrop = document.createElement('div');
                    backdrop.id = 'context-menu-backdrop';
                    backdrop.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        z-index: 9999;
                        background: transparent;
                    `;
                    backdrop.addEventListener('click', hideContextMenu);
                    document.body.appendChild(backdrop);
                }
            }

            // Hide context menu
            function hideContextMenu() {
                if (contextMenu.style.display === 'block') {
                    contextMenu.style.animation = 'contextMenuFadeOut 0.15s ease-out';
                    setTimeout(() => {
                        contextMenu.style.display = 'none';
                    }, 150);
                }

                // Remove backdrop
                const backdrop = document.getElementById('context-menu-backdrop');
                if (backdrop) {
                    backdrop.remove();
                }
            }

            function executeCommand(command) {
                console.log('Executing command:', command);

                // If there's a command input field, populate it
                const commandInput = document.getElementById('command-input');
                if (commandInput) {
                    commandInput.value = command;
                    commandInput.focus();

                    // Trigger Enter key to execute if it's a simple command
                    if (!command.includes('prompt:')) {
                        setTimeout(() => {
                            const event = new KeyboardEvent('keydown', {
                                key: 'Enter',
                                code: 'Enter',
                                keyCode: 13,
                                bubbles: true
                            });
                            commandInput.dispatchEvent(event);
                        }, 100);
                    }
                } else {
                    // Fallback: alert or console
                    alert(`Command: ${command}\n\nThis would execute in the terminal.`);
                }
            }

            // Show command prompt
            function showCommandPrompt(promptText, commandPrefix) {
                const prompt = promptText || 'Enter value:';
                const userInput = window.prompt(prompt);

                if (userInput !== null && userInput.trim() !== '') {
                    const fullCommand = `${commandPrefix} ${userInput.trim()}`;
                    executeCommand(fullCommand);
                }
            }

            // Copy selected text
            function copySelection() {
                const selectedText = window.getSelection().toString();
                if (selectedText) {
                    navigator.clipboard.writeText(selectedText).then(() => {
                        showToast('Selection copied to clipboard', 'success');
                    }).catch(err => {
                        console.error('Failed to copy:', err);
                        showToast('Failed to copy selection', 'error');
                    });
                } else {
                    showToast('No text selected', 'warning');
                }
            }

            // Paste from clipboard
            function pasteCommand() {
                navigator.clipboard.readText().then(text => {
                    const commandInput = document.getElementById('command-input');
                    if (commandInput) {
                        commandInput.value = text;
                        commandInput.focus();
                        showToast('Command pasted from clipboard', 'success');
                    }
                }).catch(err => {
                    console.error('Failed to paste:', err);
                    showToast('Failed to paste from clipboard', 'error');
                });
            }

            // Set theme
            function setTheme(themeName) {
                document.body.setAttribute('data-theme', themeName);
                localStorage.setItem('lyxprobe-theme', themeName);
                showToast(`Theme changed to ${themeName}`, 'success');
            }

            // Show settings
            function showSettings() {
                alert('Settings dialog would open here.\n\nAvailable options:\nâ€¢ Terminal font size\nâ€¢ Color scheme\nâ€¢ Auto-complete\nâ€¢ Sound effects\nâ€¢ Keyboard shortcuts');
            }

            // Toast notification
            function showToast(message, type = 'info') {
                // Create or use existing toast system
                console.log(`${type.toUpperCase()}: ${message}`);

                // Simple implementation
                const toast = document.createElement('div');
                toast.textContent = message;
                toast.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : type === 'warning' ? '#f59e0b' : '#4a90e2'};
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    z-index: 10001;
                    font-family: inherit;
                    animation: fadeIn 0.3s, fadeOut 0.3s 2.7s;
                `;

                document.body.appendChild(toast);

                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.remove();
                    }
                }, 3000);
            }

            // Add CSS for toast animation
            const toastStyle = document.createElement('style');
            toastStyle.textContent = `
                @keyframes fadeIn {
                    from { opacity: 0; transform: translateY(20px); }
                    to { opacity: 1; transform: translateY(0); }
                }

                @keyframes fadeOut {
                    from { opacity: 1; transform: translateY(0); }
                    to { opacity: 0; transform: translateY(20px); }
                }
            `;
            document.head.appendChild(toastStyle);

            // Event Listeners

            // Right-click listener for the entire document
            document.addEventListener('contextmenu', function(e) {
                // Prevent default context menu
                e.preventDefault();

                // Store position
                rightClickPosition.x = e.clientX;
                rightClickPosition.y = e.clientY;

                // Show custom context menu
                showContextMenu(e.clientX, e.clientY);

                return false;
            });

            // Click anywhere to hide context menu
            document.addEventListener('click', function(e) {
                if (!contextMenu.contains(e.target)) {
                    hideContextMenu();
                }
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Escape to close context menu
                if (e.key === 'Escape' && contextMenu.style.display === 'block') {
                    hideContextMenu();
                }

                // Ctrl+Q for quick commands
                if (e.ctrlKey && e.key === 'q') {
                    e.preventDefault();
                    showContextMenu(rightClickPosition.x, rightClickPosition.y);
                }

                // F1 for help
                if (e.key === 'F1') {
                    e.preventDefault();
                    window.open('/probe/docs', '_blank');
                }
            });

            // Prevent context menu on the context menu itself
            contextMenu.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                e.stopPropagation();
            });

            // Initialize theme from localStorage
            const savedTheme = localStorage.getItem('lyxprobe-theme') || 'dark';
            setTheme(savedTheme);
        });

        // Add CSS for theme support
        const themeCSS = `
            body[data-theme="dark"] {
                --primary-color: #4a90e2;
                --secondary-color: #8b5cf6;
                --accent-color: #00d4ff;
            }

            body[data-theme="light"] {
                --primary-color: #2563eb;
                --secondary-color: #7c3aed;
                --accent-color: #06b6d4;
                background: #f8fafc;
                color: #1e293b;
            }

            body[data-theme="cyberpunk"] {
                --primary-color: #ff00ff;
                --secondary-color: #00ffff;
                --accent-color: #ffff00;
                background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 100%);
                color: #00ff00;
            }
        `;

        // Add theme CSS to document
        if (!document.getElementById('theme-css')) {
            const style = document.createElement('style');
            style.id = 'theme-css';
            style.textContent = themeCSS;
            document.head.appendChild(style);
        }        
    </script>
</body>
</html>