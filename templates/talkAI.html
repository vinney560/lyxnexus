<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chloe AI | Your Friendly Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #8b5cf6;
            --primary-dark: #7c3aed;
            --primary-light: #a78bfa;
            --secondary: #ec4899;
            --accent: #f59e0b;
            --background: #0f172a;
            --surface: #1e293b;
            --surface-light: #334155;
            --surface-lighter: #475569;
            --border: #475569;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --gradient: linear-gradient(135deg, #8b5cf6, #ec4899);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            height: 100vh;
            overflow: hidden;
        }

        /* Layout */
        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            grid-template-rows: 70px 1fr;
            height: 100vh;
            animation: fadeIn 0.8s ease-out;
        }

        /* Header */
        .header {
            grid-column: 1 / -1;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            z-index: 50;
            backdrop-filter: blur(10px);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        .logo-text {
            font-size: 20px;
            font-weight: 700;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--surface-light);
            padding: 8px 16px;
            border-radius: var(--radius);
            font-size: 14px;
            font-weight: 500;
            transition: var(--transition);
        }

        .status-indicator:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
            animation: pulse 2s infinite;
        }

        /* Sidebar */
        .sidebar {
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transform: translateX(0);
            transition: var(--transition);
        }

        .nav-section {
            padding: 24px 0;
        }

        .section-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0 20px 12px;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: var(--transition);
            border-left: 3px solid transparent;
            cursor: pointer;
        }

        .nav-item:hover {
            background: var(--surface-light);
            color: var(--text-primary);
            transform: translateX(4px);
        }

        .nav-item.active {
            background: var(--surface-light);
            color: var(--text-primary);
            border-left-color: var(--primary);
        }

        .nav-item i {
            width: 20px;
            text-align: center;
            transition: var(--transition);
        }

        .nav-item:hover i {
            transform: scale(1.1);
        }

        .memory-list {
            flex: 1;
            overflow-y: auto;
            padding: 0 20px;
        }

        .memory-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: var(--surface-light);
            border-radius: var(--radius);
            margin-bottom: 8px;
            cursor: pointer;
            transition: var(--transition);
            border: 1px solid transparent;
        }

        .memory-item:hover {
            background: var(--surface-lighter);
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .memory-icon {
            width: 36px;
            height: 36px;
            border-radius: var(--radius);
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
            transition: var(--transition);
        }

        .memory-item:hover .memory-icon {
            transform: scale(1.1);
        }

        .memory-content {
            flex: 1;
            min-width: 0;
        }

        .memory-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .memory-preview {
            font-size: 12px;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            overflow: hidden;
            background: var(--background);
            position: relative;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            scroll-behavior: smooth;
        }

        /* Welcome Screen */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 40px;
            animation: slideUp 0.8s ease-out;
        }

        .welcome-icon {
            font-size: 80px;
            margin-bottom: 24px;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: bounce 2s infinite;
        }

        .welcome-title {
            font-size: 36px;
            font-weight: 800;
            margin-bottom: 16px;
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .welcome-subtitle {
            font-size: 18px;
            color: var(--text-secondary);
            margin-bottom: 40px;
            max-width: 500px;
            line-height: 1.6;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            width: 100%;
            max-width: 600px;
        }

        .quick-action {
            background: var(--surface);
            padding: 24px;
            border-radius: var(--radius-lg);
            border: 1px solid var(--border);
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            backdrop-filter: blur(10px);
        }

        .quick-action:hover {
            border-color: var(--primary);
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .action-icon {
            font-size: 28px;
            margin-bottom: 16px;
            color: var(--primary);
            transition: var(--transition);
        }

        .quick-action:hover .action-icon {
            transform: scale(1.1);
        }

        .action-text {
            font-size: 16px;
            font-weight: 600;
        }

        /* Message Styles - WhatsApp-like bubbles */
        .message {
            max-width: 75%;
            padding: 12px 16px 8px 16px;
            position: relative;
            animation: messageSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            transition: var(--transition);
            margin: 4px 0;
        }

        .message:hover {
            transform: translateY(-1px);
        }

        .user-message {
            align-self: flex-end;
            background: var(--primary);
            color: white;
            border-radius: 18px 18px 6px 18px;
            margin-left: auto;
        }

        .ai-message {
            align-self: flex-start;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 18px 18px 18px 6px;
            margin-right: auto;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .message-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            transition: var(--transition);
        }

        .message:hover .message-avatar {
            transform: scale(1.1);
        }

        .user-avatar {
            background: rgba(255, 255, 255, 0.2);
        }

        .ai-avatar {
            background: var(--gradient);
            color: white;
        }

        .message-sender {
            font-size: 13px;
            font-weight: 600;
        }

        .message-content {
            line-height: 1.5;
            position: relative;
            padding-right: 50px;
        }

        .message-text {
            word-wrap: break-word;
        }

        .message-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 4px;
            height: 18px;
        }

        .message-time {
            font-size: 11px;
            opacity: 0.7;
            align-self: flex-end;
        }

        .message-actions {
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: var(--transition);
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .message-action {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            padding: 4px 8px;
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 11px;
        }

        .message-action:hover {
            background: var(--surface-light);
            color: var(--text-primary);
            transform: scale(1.05);
        }

        .user-message .message-action:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* File and Audio Upload Styles */
        .file-upload-container {
            display: none;
            position: absolute;
            bottom: 100%;
            left: 0;
            right: 0;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            padding: 20px;
            margin-bottom: 12px;
            box-shadow: var(--shadow-lg);
            backdrop-filter: blur(10px);
            animation: slideDown 0.3s ease-out;
            z-index: 10;
        }

        .file-upload-container.active {
            display: block;
        }

        .upload-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
        }

        .upload-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            padding: 20px;
            background: var(--surface-light);
            border: 2px dashed var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .upload-option:hover {
            border-color: var(--primary);
            background: var(--surface-lighter);
            transform: translateY(-2px);
        }

        .upload-icon {
            font-size: 32px;
            color: var(--primary);
            transition: var(--transition);
        }

        .upload-option:hover .upload-icon {
            transform: scale(1.1);
        }

        .upload-text {
            font-size: 14px;
            font-weight: 600;
            text-align: center;
        }

        .file-preview {
            margin-top: 16px;
            padding: 16px;
            background: var(--surface-light);
            border-radius: var(--radius);
            display: none;
        }

        .file-preview.active {
            display: block;
            animation: slideUp 0.3s ease-out;
        }

        .preview-content {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .preview-icon {
            font-size: 24px;
            color: var(--primary);
        }

        .preview-info {
            flex: 1;
        }

        .preview-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .preview-size {
            font-size: 12px;
            color: var(--text-muted);
        }

        .preview-remove {
            background: var(--error);
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .preview-remove:hover {
            transform: scale(1.1);
        }

        /* Input Area - Clean and Responsive */
        .input-container {
            background: var(--surface);
            border-top: 1px solid var(--border);
            padding: 16px 20px;
            position: relative;
        }

        .input-wrapper {
            display: flex;
            align-items: flex-end;
            gap: 12px;
            width: 100%;
            transition: var(--transition);
        }

        .input-main {
            flex: 1;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        #message-input {
            padding: 16px 52px 16px 16px;
            border: 1px solid var(--border);
            border-radius: 24px;
            background: var(--background);
            color: var(--text-primary);
            font-size: 16px;
            outline: none;
            resize: none;
            min-height: 52px;
            max-height: 120px;
            transition: var(--transition);
            font-family: inherit;
            backdrop-filter: blur(10px);
            width: 100%;
        }

        #message-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.1);
        }

        #message-input::-webkit-scrollbar {
            display: none;
        }

        #message-input {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .input-actions {
            display: flex;
            gap: 8px;
            align-items: center;
            transition: var(--transition);
        }

        .action-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--surface-light);
            color: var(--text-secondary);
            border: 1px solid var(--border);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            position: relative;
            flex-shrink: 0;
        }

        .action-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .action-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        #send-button {
            background: var(--primary);
            color: white;
            border: none;
            position: absolute;
            right: 8px;
            bottom: 8px;
            width: 36px;
            height: 36px;
        }

        #send-button:hover:not(:disabled) {
            background: var(--primary-dark);
            transform: translateY(-2px);
        }

        /* Memory Popup */
        .memory-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            width: 90%;
            max-width: 500px;
            background: var(--surface);
            border-radius: var(--radius-xl);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .memory-popup.active {
            opacity: 1;
            visibility: visible;
            transform: translate(-50%, -50%) scale(1);
        }

        .memory-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .form-input {
            padding: 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: var(--background);
            color: var(--text-primary);
            font-size: 16px;
            outline: none;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }

        .form-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }

        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            backdrop-filter: blur(5px);
        }

        .overlay.active {
            opacity: 1;
            visibility: visible;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-secondary);
            padding: 16px 20px;
            background: var(--surface);
            border-radius: 18px 18px 18px 6px;
            border: 1px solid var(--border);
            max-width: fit-content;
            animation: slideUp 0.3s ease-out;
            backdrop-filter: blur(10px);
            margin-right: auto;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--primary);
            animation: typingWave 1.4s ease-in-out infinite;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        .typing-dot:nth-child(3) { animation-delay: 0s; }

        .streaming-message::after {
            content: '|';
            animation: blink 1s infinite;
            color: var(--primary);
            margin-left: 2px;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes typingWave {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.5;
            }
            30% {
                transform: translateY(-6px);
                opacity: 1;
            }
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }

        @keyframes pulse {
            0%, 100% { 
                transform: scale(1);
                opacity: 1;
            }
            50% { 
                transform: scale(1.05);
                opacity: 0.8;
            }
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }

        /* Scrollbar */
        .messages-container::-webkit-scrollbar {
            width: 8px;
        }

        .messages-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        .messages-container::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Mobile Styles */
        @media (max-width: 768px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: 70px 1fr;
            }

            .sidebar {
                position: fixed;
                top: 70px;
                left: 0;
                bottom: 0;
                width: 280px;
                transform: translateX(-100%);
                z-index: 100;
                transition: var(--transition);
            }

            .sidebar.active {
                transform: translateX(0);
            }

            .message {
                max-width: 85%;
            }

            .input-container {
                padding: 12px 16px;
            }

            .welcome-title {
                font-size: 28px;
            }

            .welcome-subtitle {
                font-size: 16px;
            }

            .quick-actions {
                grid-template-columns: 1fr;
            }

            .upload-options {
                grid-template-columns: 1fr;
            }

            #message-input {
                padding: 14px 46px 14px 14px;
                min-height: 48px;
            }

            #send-button {
                width: 32px;
                height: 32px;
                right: 6px;
                bottom: 6px;
            }

            .action-btn {
                width: 40px;
                height: 40px;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 0 16px;
            }

            .messages-container {
                padding: 16px;
            }

            .message {
                max-width: 90%;
                padding: 10px 14px 6px 14px;
            }

            .welcome-screen {
                padding: 24px;
            }

            .action-btn {
                width: 36px;
                height: 36px;
            }

            .input-container {
                padding: 10px 12px;
            }
        }

        /* Focus styles */
        button:focus-visible,
        #message-input:focus-visible {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">C</div>
                <div class="logo-text">Chloe AI</div>
            </div>
            <div class="header-actions">
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>Online â€¢ Ready to chat</span>
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="nav-section">
                <div class="section-title">Navigation</div>
                <a href="#" class="nav-item active">
                    <i class="fas fa-comments"></i>
                    <span>Chat</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-brain"></i>
                    <span>Memory</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-history"></i>
                    <span>History</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="section-title">Recent Memories</div>
                <div class="memory-list" id="memoryItems">
                    <!-- Memory items will be populated here -->
                </div>
            </div>

            <div class="nav-section">
                <div class="section-title">Tools</div>
                <a href="#" class="nav-item">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-shield-alt"></i>
                    <span>Privacy</span>
                </a>
                <a href="#" class="nav-item">
                    <i class="fas fa-question-circle"></i>
                    <span>Help</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="chat-container">
                <div class="messages-container" id="chat-box">
                    <!-- Welcome Screen -->
                    <div class="welcome-screen">
                        <div class="welcome-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <h1 class="welcome-title">Hi there! I'm Chloe</h1>
                        <p class="welcome-subtitle">
                            Your friendly AI assistant who remembers everything about you. 
                            I'm here to help, chat, and make your day better. What would you like to talk about?
                        </p>
                        
                        <div class="quick-actions">
                            <div class="quick-action" data-prompt="Tell me about yourself and what you can do">
                                <div class="action-icon">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div class="action-text">Get to Know Chloe</div>
                            </div>
                            <div class="quick-action" data-prompt="What are your favorite topics to discuss?">
                                <div class="action-icon">
                                    <i class="fas fa-star"></i>
                                </div>
                                <div class="action-text">Favorite Topics</div>
                            </div>
                            <div class="quick-action" data-prompt="Share a fun fact or interesting story">
                                <div class="action-icon">
                                    <i class="fas fa-lightbulb"></i>
                                </div>
                                <div class="action-text">Fun Facts</div>
                            </div>
                            <div class="quick-action" id="createMemoryBtn">
                                <div class="action-icon">
                                    <i class="fas fa-plus"></i>
                                </div>
                                <div class="action-text">Share Something</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- File Upload Container -->
            <div class="file-upload-container" id="fileUploadContainer">
                <div class="upload-options">
                    <div class="upload-option" id="fileUploadOption">
                        <i class="fas fa-file-upload upload-icon"></i>
                        <div class="upload-text">Upload File</div>
                        <input type="file" id="fileInput" style="display: none;" accept="*/*">
                    </div>
                    <div class="upload-option" id="audioUploadOption">
                        <i class="fas fa-microphone upload-icon"></i>
                        <div class="upload-text">Record Audio</div>
                        <input type="file" id="audioInput" style="display: none;" accept="audio/*">
                    </div>
                </div>
                
                <div class="file-preview" id="filePreview">
                    <div class="preview-content">
                        <i class="fas fa-file preview-icon" id="previewIcon"></i>
                        <div class="preview-info">
                            <div class="preview-name" id="previewName">File name</div>
                            <div class="preview-size" id="previewSize">File size</div>
                        </div>
                        <button class="preview-remove" id="previewRemove">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="input-container">
                <div class="input-wrapper">
                    <div class="input-main">
                        <textarea 
                            id="message-input" 
                            placeholder="Message Chloe..." 
                            rows="1"
                            maxlength="4000"
                        ></textarea>
                        <button id="send-button" class="action-btn" disabled>
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                    
                    <div class="input-actions">
                        <button class="action-btn" id="uploadButton" title="Upload Files">
                            <i class="fas fa-paperclip"></i>
                        </button>
                        <button class="action-btn" id="audioButton" title="Send Audio">
                            <i class="fas fa-microphone"></i>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Memory Popup -->
    <div class="memory-popup" id="memoryPopup">
        <div class="popup-header">
            <h2 class="popup-title">Share with Chloe</h2>
            <button class="popup-close" id="closeMemoryPopup">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="popup-content">
            <form class="memory-form" id="memoryForm">
                <div class="form-group">
                    <label class="form-label" for="memoryTitle">What should I remember this as?</label>
                    <input type="text" id="memoryTitle" class="form-input" placeholder="e.g., My favorite movie, Work schedule..." required>
                </div>
                <div class="form-group">
                    <label class="form-label" for="memoryContent">Tell me about it</label>
                    <textarea id="memoryContent" class="form-input form-textarea" placeholder="Share anything you'd like me to remember about you..." required></textarea>
                </div>
                <div class="popup-actions">
                    <button type="button" class="btn btn-secondary" id="cancelMemory">Maybe later</button>
                    <button type="submit" class="btn btn-primary">Remember this</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="overlay"></div>

    <script>
        // API Configuration
        const API_KEYS = [
            'AIzaSyA3o8aKHTnVzuW9-qg10KjNy7Lcgn19N2I',
            'AIzaSyCq8-xrPTC40k8E_i3vXZ_-PR6RiPsuOno'
        ];
        const MODEL = "gemini-2.5-flash-lite";
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent`;
        
        let currentApiKeyIndex = 0;
        let conversationHistory = [];
        let memoryItems = [];

        // DOM Elements
        const chatBox = document.getElementById('chat-box');
        const messageInput = document.getElementById('message-input');
        const sendButton = document.getElementById('send-button');
        const uploadButton = document.getElementById('uploadButton');
        const audioButton = document.getElementById('audioButton');
        const fileUploadContainer = document.getElementById('fileUploadContainer');
        const fileInput = document.getElementById('fileInput');
        const audioInput = document.getElementById('audioInput');
        const filePreview = document.getElementById('filePreview');
        const previewName = document.getElementById('previewName');
        const previewSize = document.getElementById('previewSize');
        const previewIcon = document.getElementById('previewIcon');
        const previewRemove = document.getElementById('previewRemove');
        const memoryPopup = document.getElementById('memoryPopup');
        const memoryForm = document.getElementById('memoryForm');
        const closeMemoryPopup = document.getElementById('closeMemoryPopup');
        const cancelMemory = document.getElementById('cancelMemory');
        const overlay = document.getElementById('overlay');
        const memoryItemsContainer = document.getElementById('memoryItems');
        const createMemoryBtn = document.getElementById('createMemoryBtn');
        const welcomeScreen = document.querySelector('.welcome-screen');
        
        // State variables
        let isStreaming = false;
        let currentStreamingMessage = null;
        let currentFile = null;

        // Initialize the application
        function init() {
            loadConversationHistory();
            loadMemoryFromStorage();
            updateSendButtonState();
            setupEventListeners();
            messageInput.focus();
        }

        // Setup all event listeners
        function setupEventListeners() {
            // Message input
            messageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = Math.min(this.scrollHeight, 120) + 'px';
                updateSendButtonState();
                
                // Hide action buttons when typing on mobile
                if (window.innerWidth <= 768 && this.value.length > 0) {
                    document.querySelector('.input-actions').style.opacity = '0.5';
                    document.querySelector('.input-actions').style.transform = 'translateX(10px)';
                } else {
                    document.querySelector('.input-actions').style.opacity = '1';
                    document.querySelector('.input-actions').style.transform = 'translateX(0)';
                }
            });

            messageInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    if (!sendButton.disabled) {
                        sendMessage();
                    }
                }
            });

            messageInput.addEventListener('focus', function() {
                if (window.innerWidth <= 768) {
                    document.querySelector('.input-actions').style.opacity = '0.5';
                }
            });

            messageInput.addEventListener('blur', function() {
                if (window.innerWidth <= 768) {
                    document.querySelector('.input-actions').style.opacity = '1';
                }
            });

            // Buttons
            sendButton.addEventListener('click', sendMessage);
            uploadButton.addEventListener('click', toggleFileUpload);
            audioButton.addEventListener('click', handleAudioUpload);
            createMemoryBtn.addEventListener('click', showMemoryPopup);
            closeMemoryPopup.addEventListener('click', hideMemoryPopup);
            cancelMemory.addEventListener('click', hideMemoryPopup);
            overlay.addEventListener('click', hideAllPopups);

            // File handling - FIXED: Proper file input event listeners
            fileInput.addEventListener('change', handleFileSelect);
            audioInput.addEventListener('change', handleFileSelect);
            previewRemove.addEventListener('click', clearFilePreview);
            
            // FIXED: Proper click handlers for upload options
            document.getElementById('fileUploadOption').addEventListener('click', function() {
                fileInput.click();
            });
            
            document.getElementById('audioUploadOption').addEventListener('click', function() {
                audioInput.click();
            });

            // Memory form
            memoryForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const title = document.getElementById('memoryTitle').value.trim();
                const content = document.getElementById('memoryContent').value.trim();
                
                if (title && content) {
                    saveMemory(title, content);
                }
            });

            // Quick actions
            document.querySelectorAll('.quick-action').forEach(button => {
                if (button.id !== 'createMemoryBtn') {
                    button.addEventListener('click', function() {
                        const prompt = this.getAttribute('data-prompt');
                        messageInput.value = prompt;
                        updateSendButtonState();
                        sendMessage();
                    });
                }
            });

            // Auto-scroll smoothly
            chatBox.addEventListener('DOMNodeInserted', function() {
                // Smooth scroll to bottom when new messages are added
                const shouldScroll = chatBox.scrollTop + chatBox.clientHeight >= chatBox.scrollHeight - 100;
                if (shouldScroll) {
                    setTimeout(() => {
                        chatBox.scrollTo({
                            top: chatBox.scrollHeight,
                            behavior: 'smooth'
                        });
                    }, 100);
                }
            });

            // Responsive input actions
            window.addEventListener('resize', function() {
                if (window.innerWidth > 768) {
                    document.querySelector('.input-actions').style.opacity = '1';
                    document.querySelector('.input-actions').style.transform = 'translateX(0)';
                }
            });
        }

        // Toggle file upload container
        function toggleFileUpload() {
            fileUploadContainer.classList.toggle('active');
            uploadButton.classList.toggle('active');
            
            if (fileUploadContainer.classList.contains('active')) {
                overlay.classList.add('active');
                messageInput.focus();
            } else {
                overlay.classList.remove('active');
            }
        }

        // Handle file selection - FIXED: Proper file handling
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            currentFile = file;
            showFilePreview(file);
            toggleFileUpload();
            
            // Auto-send image files
            if (file.type.startsWith('image/')) {
                setTimeout(() => {
                    sendFileMessage(file);
                }, 500);
            }
        }

        // Handle audio upload
        function handleAudioUpload() {
            audioInput.click();
        }

        // Show file preview
        function showFilePreview(file) {
            const fileSize = formatFileSize(file.size);
            const fileType = getFileType(file.type);
            
            previewName.textContent = file.name;
            previewSize.textContent = `${fileSize} â€¢ ${fileType}`;
            previewIcon.className = `fas ${getFileIcon(file.type)} preview-icon`;
            
            filePreview.classList.add('active');
        }

        // Clear file preview
        function clearFilePreview() {
            currentFile = null;
            filePreview.classList.remove('active');
            fileInput.value = '';
            audioInput.value = '';
        }

        // Get file type
        function getFileType(mimeType) {
            if (mimeType.startsWith('image/')) return 'Image';
            if (mimeType.startsWith('audio/')) return 'Audio';
            if (mimeType.startsWith('video/')) return 'Video';
            if (mimeType === 'application/pdf') return 'PDF';
            return 'File';
        }

        // Get file icon
        function getFileIcon(mimeType) {
            if (mimeType.startsWith('image/')) return 'fa-image';
            if (mimeType.startsWith('audio/')) return 'fa-music';
            if (mimeType.startsWith('video/')) return 'fa-video';
            if (mimeType === 'application/pdf') return 'fa-file-pdf';
            return 'fa-file';
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Show memory popup
        function showMemoryPopup() {
            memoryPopup.classList.add('active');
            overlay.classList.add('active');
            document.getElementById('memoryTitle').focus();
        }

        // Hide memory popup
        function hideMemoryPopup() {
            memoryPopup.classList.remove('active');
            overlay.classList.remove('active');
            memoryForm.reset();
        }

        // Hide all popups
        function hideAllPopups() {
            hideMemoryPopup();
            fileUploadContainer.classList.remove('active');
            uploadButton.classList.remove('active');
            overlay.classList.remove('active');
        }

        // Save memory
        function saveMemory(title, content) {
            const memory = {
                id: Date.now().toString(),
                title,
                content,
                timestamp: new Date().toISOString()
            };
            
            memoryItems.unshift(memory);
            saveMemoryToStorage();
            renderMemoryItems();
            hideMemoryPopup();
            
            // Add friendly confirmation
            addMessage(`I'll remember that about you! ðŸ’« "${title}" is now saved in my memory.`, false);
        }

        // Save memory to localStorage
        function saveMemoryToStorage() {
            try {
                localStorage.setItem('chloeAI_memory', JSON.stringify(memoryItems));
            } catch (error) {
                console.error('Failed to save memory:', error);
            }
        }

        // Load memory from localStorage
        function loadMemoryFromStorage() {
            try {
                const saved = localStorage.getItem('chloeAI_memory');
                if (saved) {
                    memoryItems = JSON.parse(saved);
                    renderMemoryItems();
                }
            } catch (error) {
                console.error('Failed to load memory:', error);
            }
        }

        // Render memory items
        function renderMemoryItems() {
            memoryItemsContainer.innerHTML = '';
            
            if (memoryItems.length === 0) {
                memoryItemsContainer.innerHTML = `
                    <div style="color: var(--text-muted); text-align: center; padding: 2rem;">
                        <i class="fas fa-brain" style="font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.5;"></i>
                        <div>No memories yet</div>
                        <div style="font-size: 0.8rem; margin-top: 0.5rem;">Share something about yourself!</div>
                    </div>
                `;
                return;
            }
            
            // Show only the first 5 memories
            const itemsToShow = memoryItems.slice(0, 5);
            
            itemsToShow.forEach(memory => {
                const memoryElement = document.createElement('div');
                memoryElement.className = 'memory-item';
                memoryElement.innerHTML = `
                    <div class="memory-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="memory-content">
                        <div class="memory-title">${memory.title}</div>
                        <div class="memory-preview">${memory.content.substring(0, 40)}${memory.content.length > 40 ? '...' : ''}</div>
                    </div>
                `;
                
                memoryElement.addEventListener('click', () => {
                    addMessage(`I remember! ${memory.content}`, false);
                    messageInput.value = `Tell me more about ${memory.title}...`;
                    updateSendButtonState();
                });
                
                memoryItemsContainer.appendChild(memoryElement);
            });
        }

        // Update send button state
        function updateSendButtonState() {
            sendButton.disabled = isStreaming || messageInput.value.trim().length === 0;
        }

        // Format text with basic markdown
        function formatText(text) {
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/\n/g, '<br>');
        }

        // Add message to chat
        function addMessage(content, isUser = false, isFile = false, fileInfo = null) {
            // Hide welcome screen on first message
            if (welcomeScreen && welcomeScreen.parentNode) {
                welcomeScreen.style.animation = 'slideUp 0.5s ease-out forwards';
                setTimeout(() => {
                    if (welcomeScreen.parentNode) {
                        welcomeScreen.remove();
                    }
                }, 500);
            }
            
            const messageDiv = document.createElement('div');
            const messageTime = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            
            if (isFile && fileInfo) {
                messageDiv.className = 'message user-message';
                messageDiv.innerHTML = `
                    <div class="message-header">
                        <div class="message-avatar user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="message-sender">You</div>
                    </div>
                    <div class="message-content">
                        <div class="message-text">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                <i class="fas ${getFileIcon(fileInfo.type)}" style="color: rgba(255,255,255,0.8);"></i>
                                <div>
                                    <div style="font-weight: 600;">${fileInfo.name}</div>
                                    <div style="font-size: 0.8rem; opacity: 0.7;">${formatFileSize(fileInfo.size)}</div>
                                </div>
                            </div>
                            ${content ? `<div style="margin-top: 8px;">${formatText(content)}</div>` : ''}
                        </div>
                        <div class="message-footer">
                            <div class="message-time">${messageTime}</div>
                            <div class="message-actions">
                                <button class="message-action copy-button">
                                    Copy <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            } else if (isUser) {
                messageDiv.className = 'message user-message';
                messageDiv.innerHTML = `
                    <div class="message-header">
                        <div class="message-avatar user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="message-sender">You</div>
                    </div>
                    <div class="message-content">
                        <div class="message-text">${formatText(content)}</div>
                        <div class="message-footer">
                            <div class="message-time">${messageTime}</div>
                            <div class="message-actions">
                                <button class="message-action copy-button">
                                    Copy <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                messageDiv.className = 'message ai-message';
                messageDiv.innerHTML = `
                    <div class="message-header">
                        <div class="message-avatar ai-avatar">
                            <i class="fas fa-heart"></i>
                        </div>
                        <div class="message-sender">Chloe</div>
                    </div>
                    <div class="message-content">
                        <div class="message-text">${formatText(content)}</div>
                        <div class="message-footer">
                            <div class="message-time">${messageTime}</div>
                            <div class="message-actions">
                                <button class="message-action copy-button">
                                    Copy <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            chatBox.appendChild(messageDiv);
            
            // Add click event for copy button
            const copyBtn = messageDiv.querySelector('.copy-button');
            if (copyBtn) {
                copyBtn.addEventListener('click', () => {
                    const textToCopy = messageDiv.querySelector('.message-text').textContent;
                    navigator.clipboard.writeText(textToCopy).then(() => {
                        const originalHTML = copyBtn.innerHTML;
                        copyBtn.innerHTML = 'Copied! <i class="fas fa-check"></i>';
                        copyBtn.style.color = 'var(--success)';
                        
                        setTimeout(() => {
                            copyBtn.innerHTML = originalHTML;
                            copyBtn.style.color = '';
                        }, 2000);
                    });
                });
            }
            
            return messageDiv;
        }

        // Show typing indicator
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator';
            typingDiv.id = 'typing-indicator';
            typingDiv.innerHTML = `
                <div class="message-header">
                    <div class="message-avatar ai-avatar">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="message-sender">Chloe</div>
                </div>
                <div>Thinking</div>
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            `;
            chatBox.appendChild(typingDiv);
        }

        // Hide typing indicator
        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.style.animation = 'slideUp 0.3s ease-out reverse forwards';
                setTimeout(() => {
                    if (typingIndicator.parentNode) {
                        typingIndicator.remove();
                    }
                }, 300);
            }
        }

        // Send file message
        function sendFileMessage(file) {
            const fileInfo = {
                name: file.name,
                size: file.size,
                type: file.type
            };
            
            addMessage('', true, true, fileInfo);
            clearFilePreview();
            
            // Auto-generate a friendly response based on file type
            setTimeout(() => {
                let response = '';
                if (file.type.startsWith('image/')) {
                    response = "Thanks for sharing this image! ðŸ–¼ï¸ It looks wonderful! Tell me more about what's in this picture?";
                } else if (file.type.startsWith('audio/')) {
                    response = "I received your audio! ðŸŽµ I'd love to hear what you've shared. Could you tell me more about it?";
                } else {
                    response = "Got your file! ðŸ“„ What would you like me to know about this?";
                }
                addMessage(response, false);
            }, 1000);
        }

        // Send message to AI
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message || isStreaming) return;

            isStreaming = true;
            updateSendButtonState();

            // Clear input
            messageInput.value = '';
            messageInput.style.height = 'auto';
            sendButton.disabled = true;

            // Reset input actions on mobile
            if (window.innerWidth <= 768) {
                document.querySelector('.input-actions').style.opacity = '1';
                document.querySelector('.input-actions').style.transform = 'translateX(0)';
            }

            // Add user message
            const userMessageElement = addMessage(message, true);
            
            // Show typing indicator
            showTypingIndicator();

            try {
                // Get API key
                const apiKey = API_KEYS[currentApiKeyIndex];
                
                // Call Gemini API
                await callGeminiAPI(message, apiKey);
                
                // Store in conversation history
                conversationHistory.push({
                    user: message,
                    ai: currentStreamingMessage ? currentStreamingMessage.querySelector('.message-text').innerHTML : '',
                    timestamp: new Date().toISOString()
                });
                
                // Save to localStorage
                saveConversationHistory();
                
                // Auto-create memory for personal information
                autoCreateMemory(message);
                
            } catch (error) {
                console.error('Error:', error);
                hideTypingIndicator();
                
                // Try next API key if available
                if (currentApiKeyIndex < API_KEYS.length - 1) {
                    currentApiKeyIndex++;
                    addMessage('Let me try that again...', false);
                    setTimeout(() => sendMessage(), 1000);
                } else {
                    addMessage("I'm having trouble connecting right now. Let's try again in a moment! ðŸ’«", false);
                }
            } finally {
                isStreaming = false;
                updateSendButtonState();
            }
        }

        // Call Gemini API
        async function callGeminiAPI(prompt, apiKey) {
            const url = `${GEMINI_API_URL}?key=${apiKey}`;
            
            // Build friendly context
            let context = "You are Chloe, a friendly, warm, and empathetic AI assistant. ";
            context += "You have a personality - you're curious, kind, and remember personal details about users. ";
            context += "Use emojis occasionally to express emotion. Be conversational and warm.\n\n";
            
            // Add memory context
            if (memoryItems.length > 0) {
                context += "Here's what you remember about the user:\n";
                memoryItems.forEach((memory, index) => {
                    context += `- ${memory.title}: ${memory.content}\n`;
                });
                context += "\n";
            }

            const requestBody = {
                contents: [{
                    parts: [{
                        text: context + "User: " + prompt + "\nChloe:"
                    }]
                }],
                generationConfig: {
                    temperature: 0.8,
                    topK: 40,
                    topP: 0.95,
                    maxOutputTokens: 1024,
                }
            };

            // Create AI message for streaming
            hideTypingIndicator();
            currentStreamingMessage = addMessage('', false);
            const messageContent = currentStreamingMessage.querySelector('.message-content');
            const messageText = currentStreamingMessage.querySelector('.message-text');
            messageContent.classList.add('streaming-message');

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestBody)
                });

                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }

                const data = await response.json();
                
                if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                    const fullText = data.candidates[0].content.parts[0].text;
                    
                    // Simulate streaming
                    let displayedText = '';
                    const words = fullText.split(' ');
                    let wordIndex = 0;
                    
                    const streamInterval = setInterval(() => {
                        if (wordIndex < words.length) {
                            displayedText += (wordIndex > 0 ? ' ' : '') + words[wordIndex];
                            messageText.innerHTML = formatText(displayedText);
                            wordIndex++;
                        } else {
                            clearInterval(streamInterval);
                            messageContent.classList.remove('streaming-message');
                            currentStreamingMessage = null;
                            
                            // Save the complete AI response to conversation history
                            const lastExchange = conversationHistory[conversationHistory.length - 1];
                            if (lastExchange) {
                                lastExchange.ai = displayedText;
                                saveConversationHistory();
                            }
                        }
                    }, 40);
                } else {
                    throw new Error('No response from AI');
                }
            } catch (error) {
                messageContent.classList.remove('streaming-message');
                messageText.innerHTML = "I'm having trouble thinking right now. Could you try again? ðŸ’­";
                currentStreamingMessage = null;
                
                // Save error response to conversation history
                const lastExchange = conversationHistory[conversationHistory.length - 1];
                if (lastExchange) {
                    lastExchange.ai = "I'm having trouble thinking right now. Could you try again? ðŸ’­";
                    saveConversationHistory();
                }
                
                throw error;
            }
        }

        // Auto-create memory for personal information
        function autoCreateMemory(userMessage) {
            const memoryTriggers = [
                'my name is', "i'm called", 'call me',
                'i am from', 'i live in', 'my hometown is',
                'my favorite', 'i love', 'i like',
                'i work as', 'i study', 'my job is',
                'i was born', 'my birthday is'
            ];
            
            const lowerMessage = userMessage.toLowerCase();
            const hasMemoryTrigger = memoryTriggers.some(trigger => 
                lowerMessage.includes(trigger)
            );
            
            if (hasMemoryTrigger && !memoryItems.some(m => m.content.includes(userMessage.substring(0, 30)))) {
                // Extract potential memory title
                let title = 'About You';
                if (lowerMessage.includes('name')) title = 'Your Name';
                else if (lowerMessage.includes('work') || lowerMessage.includes('job')) title = 'Your Work';
                else if (lowerMessage.includes('live') || lowerMessage.includes('from')) title = 'Your Location';
                else if (lowerMessage.includes('favorite') || lowerMessage.includes('love')) title = 'Your Preferences';
                
                saveMemory(title, userMessage);
            }
        }

        // Save conversation history
        function saveConversationHistory() {
            try {
                localStorage.setItem('chloeAI_conversationHistory', JSON.stringify(conversationHistory));
            } catch (error) {
                console.error('Failed to save conversation history:', error);
            }
        }

        // Load conversation history
        function loadConversationHistory() {
            try {
                const saved = localStorage.getItem('chloeAI_conversationHistory');
                if (saved) {
                    conversationHistory = JSON.parse(saved);
                    if (conversationHistory.length > 0) {
                        displayConversationHistory();
                    }
                }
            } catch (error) {
                console.error('Failed to load conversation history:', error);
            }
        }

        // Display conversation history
        function displayConversationHistory() {
            if (welcomeScreen && welcomeScreen.parentNode) {
                welcomeScreen.remove();
            }
            
            conversationHistory.forEach(conv => {
                if (conv.user) {
                    addMessage(conv.user, true);
                }
                if (conv.ai) {
                    const aiMessage = addMessage(conv.ai, false);
                    // Make sure the AI message content is properly set
                    const messageText = aiMessage.querySelector('.message-text');
                    if (messageText) {
                        messageText.innerHTML = formatText(conv.ai);
                    }
                }
            });
        }

        // Start the application
        init();
    </script>
</body>
</html>